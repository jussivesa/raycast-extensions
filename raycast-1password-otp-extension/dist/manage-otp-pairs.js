"use strict";var y=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var T=(e,r)=>{for(var i in r)y(e,i,{get:r[i],enumerable:!0})},D=(e,r,i,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of E(r))!N.call(e,o)&&o!==i&&y(e,o,{get:()=>r[o],enumerable:!(a=F(r,o))||a.enumerable});return e};var J=e=>D(y({},"__esModule",{value:!0}),e);var $={};T($,{default:()=>I});module.exports=J($);var t=require("@raycast/api"),m=require("react");var u=require("@raycast/api"),h=require("crypto"),w="otp_pairs";async function P(){let e=await u.LocalStorage.getItem(w);if(e)try{return JSON.parse(e).filter(l=>l&&l.label&&l.ref&&l.id)}catch{return[]}let i=(0,u.getPreferenceValues)().otp_pairs_seed?.trim();if(!i)return[];let a=g(i);return a.length>0?(await p(a),a):[]}async function p(e){let r=e.map(i=>({id:i.id||b(),label:i.label.trim(),ref:i.ref.trim()}));await u.LocalStorage.setItem(w,JSON.stringify(r))}async function A(e,r){let i=await P(),a={id:b(),label:e.trim(),ref:r.trim()};return i.push(a),await p(i),a}async function O(e){let r=await P(),i=r.findIndex(a=>a.id===e.id);i>=0&&(r[i]={...e,label:e.label.trim(),ref:e.ref.trim()},await p(r))}async function x(e){let i=(await P()).filter(a=>a.id!==e);await p(i)}function C(e){let r=e.map(i=>({label:i.label,ref:i.ref}));return JSON.stringify(r,null,2)}function g(e){let r=e.trim();if(!r)return[];try{let o=JSON.parse(r);if(Array.isArray(o)){let l=o.filter(c=>c&&typeof c.label=="string"&&typeof c.ref=="string").map(c=>({id:b(),label:c.label.trim(),ref:c.ref.trim()})).filter(c=>c.label&&c.ref);if(l.length>0)return l}}catch{}let i=r.split(/\r?\n/),a=[];for(let o of i){let l=o.match(/^\s*(.+?)\s*=\s*(op:\/\/.*)\s*$/);if(l){let c=l[1].trim(),n=l[2].trim();c&&n&&a.push({id:b(),label:c,ref:n})}}return _(a)}function v(e,r){let i=new Map(e.map(a=>[a.label.toLowerCase(),a]));for(let a of r){let o=a.label.toLowerCase();if(i.has(o)){let l=i.get(o);i.set(o,{...l,ref:a.ref})}else i.set(o,a)}return Array.from(i.values())}function _(e){let r=new Set,i=[];for(let a of e){let o=a.label.toLowerCase();r.has(o)||(r.add(o),i.push(a))}return i}function b(){try{return(0,h.randomUUID)()}catch{return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}}var s=require("react/jsx-runtime");function I(){let[e,r]=(0,m.useState)(null);(0,m.useEffect)(()=>{(async()=>{let n=await P();r(n)})()},[]);async function i(n){n.ref.endsWith("?attribute=otp")===!1&&(n.ref=n.ref+"?attribute=otp");let f=await A(n.label,n.ref);r(d=>Array.isArray(d)?[...d,f]:[f]),await(0,t.showToast)({style:t.Toast.Style.Success,title:"Pair added"})}async function a(n){await O(n),r(f=>f?.map(d=>d.id===n.id?n:d)??[n]),await(0,t.showToast)({style:t.Toast.Style.Success,title:"Pair updated"})}async function o(n){await(0,t.confirmAlert)({title:"Delete Pair?",message:"This cannot be undone.",primaryAction:{title:"Delete",style:t.Alert.ActionStyle.Destructive}})&&(await x(n),r(d=>d?.filter(L=>L.id!==n)??[]),await(0,t.showToast)({style:t.Toast.Style.Success,title:"Pair deleted"}))}async function l(){let n=C(e??[]);await t.Clipboard.copy(n),await(0,t.showToast)({style:t.Toast.Style.Success,title:"Exported to clipboard"})}async function c(){let n=await t.Clipboard.readText();if(!n){await(0,t.showToast)({style:t.Toast.Style.Failure,title:"Clipboard is empty"});return}let f=g(n);if(f.length===0){await(0,t.showToast)({style:t.Toast.Style.Failure,title:"Nothing to import"});return}let d=v(e??[],f);await p(d),r(d),await(0,t.showToast)({style:t.Toast.Style.Success,title:`Imported ${f.length} entr${f.length===1?"y":"ies"}`})}return(0,s.jsxs)(t.List,{isLoading:e===null,searchBarPlaceholder:"Search labels...",children:[(0,s.jsx)(t.List.EmptyView,{title:"No pairs yet",description:"Add your first label/reference pair. You can also paste JSON or 'Label = op://...' lines.",actions:(0,s.jsx)(k,{onAdd:i,onImport:c})}),e?.map(n=>(0,s.jsx)(t.List.Item,{title:n.label,subtitle:n.ref,actions:(0,s.jsxs)(t.ActionPanel,{children:[(0,s.jsx)(t.Action.Push,{icon:t.Icon.Plus,title:"Add Pair",target:(0,s.jsx)(S,{onSubmit:i})}),(0,s.jsx)(t.Action.Push,{icon:t.Icon.Pencil,title:"Edit Pair",target:(0,s.jsx)(S,{pair:n,onSubmit:f=>a({...n,...f})})}),(0,s.jsx)(t.Action,{icon:t.Icon.Trash,title:"Delete Pair",style:t.Action.Style.Destructive,onAction:()=>o(n.id)}),(0,s.jsx)(t.Action,{icon:t.Icon.Clipboard,title:"Export Pairs to Clipboard",onAction:l}),(0,s.jsx)(t.Action,{icon:t.Icon.Clipboard,title:"Import Pairs from Clipboard",onAction:c})]})},n.id))]})}function k({onAdd:e,onImport:r}){return(0,s.jsxs)(t.ActionPanel,{children:[(0,s.jsx)(t.Action.Push,{icon:t.Icon.Plus,title:"Add Pair",target:(0,s.jsx)(S,{onSubmit:e})}),(0,s.jsx)(t.Action,{icon:t.Icon.Clipboard,title:"Import Pairs from Clipboard",onAction:r})]})}function S({pair:e,onSubmit:r}){let[i,a]=(0,m.useState)(e?.label??""),[o,l]=(0,m.useState)(e?.ref??"");function c(){if(!i.trim()||!o.trim()){(0,t.showToast)({style:t.Toast.Style.Failure,title:"Label and reference are required"});return}r({label:i.trim(),ref:o.trim()})}return(0,s.jsxs)(t.Form,{actions:(0,s.jsx)(t.ActionPanel,{children:(0,s.jsx)(t.Action.SubmitForm,{title:e?"Save Changes":"Add Pair",onSubmit:c})}),children:[(0,s.jsx)(t.Form.TextField,{id:"label",title:"Label",value:i,onChange:a,placeholder:"e.g., Google Abc Ltd",autoFocus:!0}),(0,s.jsx)(t.Form.TextField,{id:"ref",title:"OTP Reference",value:o,onChange:l,placeholder:"op://Vault/Item/Section/Field?attribute=otp"})]})}
