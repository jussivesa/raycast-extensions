"use strict";var P=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var k=(t,r)=>{for(var a in r)P(t,a,{get:r[a],enumerable:!0})},F=(t,r,a,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of _(r))!E.call(t,i)&&i!==a&&P(t,i,{get:()=>r[i],enumerable:!(n=v(r,i))||n.enumerable});return t};var N=t=>F(P({},"__esModule",{value:!0}),t);var D={};k(D,{default:()=>C});module.exports=N(D);var e=require("@raycast/api"),f=require("react");var m=require("@raycast/api"),g=require("crypto"),y="otp_pairs";async function w(){let t=await m.LocalStorage.getItem(y);if(t)try{return JSON.parse(t).filter(l=>l&&l.label&&l.ref&&l.id)}catch{return[]}let a=(0,m.getPreferenceValues)().otp_pairs_seed?.trim();if(!a)return[];let n=V(a);return n.length>0?(await J(n),n):[]}async function J(t){let r=t.map(a=>({id:a.id||d(),label:a.label.trim(),ref:a.ref.trim()}));await m.LocalStorage.setItem(y,JSON.stringify(r))}function V(t){let r=t.trim();if(!r)return[];try{let i=JSON.parse(r);if(Array.isArray(i)){let l=i.filter(s=>s&&typeof s.label=="string"&&typeof s.ref=="string").map(s=>({id:d(),label:s.label.trim(),ref:s.ref.trim()})).filter(s=>s.label&&s.ref);if(l.length>0)return l}}catch{}let a=r.split(/\r?\n/),n=[];for(let i of a){let l=i.match(/^\s*(.+?)\s*=\s*(op:\/\/.*)\s*$/);if(l){let s=l[1].trim(),u=l[2].trim();s&&u&&n.push({id:d(),label:s,ref:u})}}return M(n)}function M(t){let r=new Set,a=[];for(let n of t){let i=n.label.toLowerCase();r.has(i)||(r.add(i),a.push(n))}return a}function d(){try{return(0,g.randomUUID)()}catch{return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}}var h=require("child_process"),S=require("util"),A=require("fs/promises"),p=require("react/jsx-runtime"),L=(0,S.promisify)(h.execFile);async function $(t){let{stdout:r}=await L(t,["--version"]);return r.toString().trim()}async function O(t,r){try{let{stdout:a}=await L(t,["read",r]);return a.toString().trim()}catch(a){let n=a?.stderr?.toString?.().trim?.();throw new Error(n||a?.message||String(a))}}async function b(t){try{return await(0,A.access)(t),!0}catch{return!1}}async function U(){let t=(0,e.getPreferenceValues)();if(t?.op_path&&await b(t.op_path))return t.op_path;let r=["/opt/homebrew/bin/op","/usr/local/bin/op","/usr/bin/op"];for(let a of r)if(await b(a))return a;return"op"}function C(){let[t,r]=(0,f.useState)(null),[a,n]=(0,f.useState)(!0),[i,l]=(0,f.useState)(!1),[s,u]=(0,f.useState)(null);(0,f.useEffect)(()=>{(async()=>{try{let c=await U();u(c);var o=await $(c);await(0,e.showToast)({style:e.Toast.Style.Success,title:"1Password CLI",message:`Version: ${o}`}),l(!0)}catch{l(!1),await(0,e.showToast)({style:e.Toast.Style.Failure,title:"1Password CLI not found or not available",message:"Install via Homebrew or set Preferences \u2192 1Password CLI Path"})}finally{n(!1)}})()},[]),(0,f.useEffect)(()=>{(async()=>{let o=await w();r(o)})()},[]);let x=t===null||a;async function I(o){try{if(!i||!s)throw new Error("1Password CLI not available");let c=await O(s,o.ref);await e.Clipboard.copy(c),await(0,e.showToast)({style:e.Toast.Style.Success,title:"OTP copied",message:o.label})}catch(c){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Failed to get OTP",message:c?.message??String(c)})}}async function T(o){try{if(!i||!s)throw new Error("1Password CLI not available");let c=await O(s,o.ref);await e.Clipboard.paste(c),await(0,e.showToast)({style:e.Toast.Style.Success,title:"OTP pasted",message:o.label})}catch(c){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Failed to paste OTP",message:c?.message??String(c)})}}return(0,p.jsx)(e.List,{isLoading:x,searchBarPlaceholder:"Search labels...",children:Array.isArray(t)&&t.length===0?(0,p.jsx)(e.List.EmptyView,{title:"No OTP pairs configured",description:"Use Manage OTP Pairs to add label/ref entries.",actions:(0,p.jsx)(B,{})}):t?.map(o=>(0,p.jsx)(e.List.Item,{title:o.label,subtitle:o.ref,actions:(0,p.jsxs)(e.ActionPanel,{children:[(0,p.jsx)(e.Action,{title:"Copy OTP",onAction:()=>I(o)}),(0,p.jsx)(e.Action,{title:"Paste OTP to App",onAction:()=>T(o)})]})},o.id))})}function B(){return(0,p.jsx)(e.ActionPanel,{children:(0,p.jsx)(e.Action,{title:"Open Manage OTP Pairs",onAction:()=>{}})})}
